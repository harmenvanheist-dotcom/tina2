<!doctype html>
<html lang="nl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Tina 2 — Audio Chat</title>

    <!-- ChatKit script -->
    <script src="https://cdn.platform.openai.com/deployments/chatkit/chatkit.js" defer></script>

    <style>
      html, body {height:100%;margin:0}
      body {display:grid;place-items:center;background:#fff}
      #status {position:fixed;top:10px;left:10px;font:14px/1.2 system-ui}
    </style>
  </head>
  <body>
    <div id="status">Laden…</div>

    <!-- Het element dat ChatKit rendert -->
    <openai-chatkit id="my-chat" style="height:620px;width:360px"></openai-chatkit>

    <script>
      (async () => {
        // wacht tot chatkit is geladen
        for (let i = 0; i < 40 && !window.chatkit; i++) await new Promise(r => setTimeout(r, 100));

        const host = location.origin;
        const el = document.getElementById('my-chat');
        const status = document.getElementById('status');

        if (!window.chatkit || !el) { status.textContent = 'Fout: ChatKit niet geladen'; return; }

        // haal clientToken (client_secret) op bij je Netlify-functie
        const resp = await fetch('/.netlify/functions/chatkit-session', { method: 'POST' });
        if (!resp.ok) { status.textContent = 'Fout: ' + resp.status + ' bij sessie'; return; }
        const { client_secret } = await resp.json(); // = clientToken

        // configureer ChatKit
        el.setOptions({
          api: { clientToken: client_secret },       // <— let ChatKit inloggen
          audio: { input: true, output: true },      // microfoon & audio
          widgets: { default: 'mini-chat-audio' }    // audio-widget
        });

        status.remove();
      })();
    </script>
  </body>
</html>
