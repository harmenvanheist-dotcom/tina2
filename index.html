<!doctype html>
<html lang="nl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://cdn.platform.openai.com/deployments/chatkit/chatkit.js" defer></script>
    <style> body { margin: 0 } #my-chat { display:block; height: 86vh; max-width: 420px; margin: 24px auto; } </style>
  </head>
  <body>
    <openai-chatkit id="my-chat"></openai-chatkit>
    <script>
      (async function mount() {
        const el = document.getElementById('my-chat');
        for (let i = 0; i < 60 && !('setOptions' in el); i++) await new Promise(r=>setTimeout(r,200));

        el.setOptions({
          api: {
            async getClientSecret(existing) {
              if (existing) return existing; // evt. refresh implementeren
              const r = await fetch('/.netlify/functions/chatkit-session', { method: 'POST' });
              const { client_secret } = await r.json();
              return client_secret;
            }
          },
          widgets: { default: 'mini-chat-audio' },
          features: { audio: { input: true, output: true } }
        });
      })();
    </script>
  </body>
</html>
