<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tina 2 â€” Audio Chat</title>
  <script src="https://cdn.platform.openai.com/deployments/chatkit/chatkit.js" defer></script>
  <style>html,body{height:100%} body{display:grid;place-items:center;margin:0}</style>
</head>
<body>
  <openai-chatkit id="my-chat" style="width:380px;height:640px"></openai-chatkit>

  <script>
    function sleep(ms){ return new Promise(r=>setTimeout(r,ms)); }
    (async () => {
      // Wacht tot ChatKit geladen is
      for (let i=0; i<50 && !window.openaiChatKit; i++) await sleep(100);

      const el = document.getElementById('my-chat');
      if (!window.openaiChatKit || !el) { 
        document.body.append('Fout: ChatKit niet geladen'); 
        return; 
      }

      async function getClientSecret(current){
        const res = await fetch('/.netlify/functions/chatkit-session', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ current })
        });
        if (!res.ok) throw new Error('session failed ' + res.status);
        const { client_secret } = await res.json();
        return client_secret;
      }

      await el.setOptions({
        api: { getClientSecret },
        // Audio aan (dit vervangt de oude, foutieve `widgets: "audio"` optie)
        features: { audio: { input: true, output: true } },
        // Start met de audio mini-chat widget
        widget: { default: 'mini-chat-audio' }
      });
    })();
  </script>
</body>
</html>
